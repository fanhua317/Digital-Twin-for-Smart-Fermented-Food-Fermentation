# 修改清单

以下清单基于当前代码结构与前后端对照分析，按影响程度排序。

## 1) 高优先级（会导致功能不可用）

- WebSocket 路径不一致：前端连接 `/ws/{channel}`，后端仅注册 `/ws/realtime`。
- WebSocket 消息类型不一致：后端推送 `pit_data`/`device_data`/`alarm`，前端仅处
  理 `dashboard_update`。
- 告警接口不匹配：
  - 前端 `PUT /alarms/{id}/resolve` 传 query 参数；
  - 后端 `PUT /alarms/{id}/resolve` 需要 body `resolvedBy`。
- 批量告警接口不匹配：
  - 前端 `PUT /alarms/resolve-batch`；
  - 后端 `POST /alarms/batch-resolve` 且 body 字段为 `ids`/`resolvedBy`。
- 生产批次接口不匹配：
  - 前端 `PUT /production/batches/{id}/start`；
  - 后端 `POST /production/batches/{id}/start`。
  - 前端 `PUT /production/batches/{id}/complete` 走 query；
  - 后端 `POST /production/batches/{id}/complete` 走 body
    `actualVolume`/`qualityScore`。

## 2) 中优先级（功能受限或数据偏差）

- `hours` 查询参数未生效：窖池/设备历史数据接口忽略 `hours`，仅返回 Top10。
- 设备运行时长更新未持久化：`SimulatorService` 只在状态变化时保存设备，运行时长
  可能不增长。
- `application.yml` 使用 H2 内存库，`backend-java/data/*.db` 目前不会被读取。

## 3) 低优先级（易用性/一致性）

- 前端调用的接口未实现：
  - `alarms/stats`
  - `production/trends`
  - `production/params` 与 `production/params/{id}` 更新
- Dashboard 接口 `stats` 与 `overview` 返回相同数据，可考虑合并或语义化区分。

## 4) 建议的对齐方式（可选策略）

- 方案 A：以现有后端为准，调整前端 API 与 WebSocket 逻辑。
- 方案 B：以现有前端为准，补齐后端路由、方法、参数与消息类型。
- 方案 C：建立 `api-contract.md` 统一约定接口与 WebSocket 协议，前后端同时对齐。
